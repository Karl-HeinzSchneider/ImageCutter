addEventListener("message",async m=>{let e=new OffscreenCanvas(100,100),a=new OffscreenCanvas(100,100),h=new FileReaderSync,i=m.data.active,g=m.data.cuts;console.log("process...",g.length,"cut(s),",i);let u=await fetch(i.file.dataURL).then(t=>t.blob()),l=await createImageBitmap(u);a.width=l.width,a.height=l.height,a.getContext("2d").drawImage(l,0,0);let r=[];for(let t=0;t<g.length;t++){let s=g[t];if(s.type==="absolute"){let o=s.absolute,n=o.width,c=o.height,f=o.x,p=o.y;e.width=n,e.height=c;let d=e.getContext("2d");d?.clearRect(0,0,n,c),d?.drawImage(a,f,p,n,c,0,0,n,c);let w=await e.convertToBlob({type:"image/png"}),b=h.readAsDataURL(w);r.push({dataURL:b,fileType:"image/png",cut:s})}else s.type}r.length>0&&postMessage({img:i,result:r})});
